import pyvisa
from Instruments.rigol_dsa815 import rigol_dsa815
import numpy as np
from math import sqrt
import time
import matplotlib.pyplot as plt
#from Instruments.instrument_strings import *
from Instruments import instrument_strings

rm = pyvisa.ResourceManager()

for resource_id in rm.list_resources():
    try:
        inst = rm.open_resource(resource_id, send_end=True) #the VISA resource
        name_str = inst.query('*IDN?').strip()
        
        if name_str == instrument_strings.RigolDSA815:
            spec_an = rigol_dsa815(inst)
            print("Connected to: " + spec_an.name.rstrip('\n'))
        
    except pyvisa.errors.VisaIOError:
        print(resource_id + " is not what we're looking for, continuing...\n")


spec_an.set_data_format('ASC')
 
data = spec_an.get_trace(trace_num=1)
#print(data)

spec_an.set_data_format('ASC')
cmd_units      = "DBUV"
rb_units      = spec_an.get_units()

data = spec_an.get_trace(trace_num=1)

# Build frequency axis
f_start = spec_an.get_start_freq()   # Hz
f_stop  = spec_an.get_stop_freq()    # Hz
freqs = np.linspace(f_start, f_stop, len(data))


